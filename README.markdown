# Quintel Energy Transition Model

## Branches

* **master**: Working branch. Please always commit to this branch and rebase from here.
* **staging**: Tracks [the beta server](http://beta.et-model.com)
* **production**: Tracks [the production server](http://et-model.com)

## Installing

* Get Ruby 1.9.2 or higher running. (use rbenv)
* Make sure you have installed on your machine:
  * memcached
* Pull this repository with `git clone git@github.com:dennisschoenmakers/etmodel.git`
* Create your own `database.yml` and `config.yml` from the samples in `config/`
* Run `bundle install`
* Run `memcached -d`
* Run `rake sunspot:solr:run`
* Create local databases for test and development (eg: `etmodel_dev`, `etmodel_test`)
* Get ssh access to staging server (ask Dennis)
* Clone the database from the staging server using `cap staging db2local`

## Deploying

Make sure everything works. Run the tests.

    $> rake spec

To deploy to staging:

    $> cap staging deploy

Do not deploy directly to production, unless you know what you're doing.


## Search

The old thinking sphinx has been replaced with SOLR. Things you should know:

On your local box the gem provides a standalone SOLR instance. You can start it
with:

    rake sunspot:solr:start

On Ubuntu servers you have to install it yourself. Ther fastest way is

    sudo apt-get install solr-tomcat

Start/stop with `sudo service tomcat6 start`. Update the `sunspot.yml` file as
needed. On production SOLR listens on port 8080.

Configuration files: copy the `schema.xml` and `solrconfig.xml` generated by
sunspot in `RAILS_ROOT/solr/conf` to `/etc/solr/conf`.
Check if SOLR is running by opening with lynx `http://localhost:8080/solr`.
If it complains about not being able to write the index directory then create it
yourself manually: `/var/lib/tomcat6/solr/data` and make sure the user SOLR is
running as has write access. It will take care of creatiing an `index` subfolder.
If you get an error about missing `segments` file delete the index folder and
restart SOLR.

Once it is running you can index everything from the console with

    RAILS_ENV=production bundle exec rake sunspot:reindex


## Links
https://github.com/sunspot/sunspot/wiki/Configure-Solr-on-Ubuntu%2C-the-quickest-way
