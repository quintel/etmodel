= stylesheet_link_tag 'prediction'
= javascript_include_tag :defaults
= sprocket_include_tag 'backcasting'
- colours = ["F00", "0F0", "00F", "FF0", "F0F", "0FF"]

.prediction
  .intro
    Hier kun je jouw scenario vergelijken met verwachtingen van experts. Jouw scenario valt binnen/buiten de expertverwachtingen. Deze verwachtingen zijn gebaseerd op een aantal maatregelen. Hoe denk jij dat de adoptie van elektrische autoâ€™s zal verlopen?
  .slider_title= @input_element.name
  .upper_block
    .chart#backcasting
    .available_predictions
      - @input_element.predictions.each do |p|
        .item
          = radio_button_tag :prediction_id, p.id, (p.id == @prediction.id)
          .color{:style => "background: #{cycle(*colours)}"}
          .label
            #{p.user.try(:name)},
            - if p.user.try(:company_school)
              #{p.user.company_school},
            = p.title
            - if v = p.last_value
              (#{v.value} in #{v.year})
            - if current_user.try(:admin?)
              = link_to 'edit', edit_admin_prediction_path(p), :target => '_new'
  .prediction_details
    = render @prediction

:javascript
  $(function(){
    // ajax loading of prediction details
    $("input[type=radio]").click(function(){
      var prediction_id = $(this).val();
      var url = "/predictions/" + prediction_id;
      console.log("Loading" + url);
      $(".prediction_details").load(url);
    });
    
    //charts
    $.jqplot("backcasting", #{@input_element.predictions.map{|p| p.values_to_a}.to_json}, {
        grid: {
          background: '#ffffff',
          borderWidth: 0,
          borderColor: '#ffffff',
          shadow: false
        },
        axes:{
          xaxis:{tickOptions:{formatString:'%.0f'}},
          yaxis:{tickOptions:{formatString:'%.0f'}}
        },
        seriesColors: #{colours.to_json}
      }
    );
    
    // extra info links
    $(".more_info a").click(function(event){
      event.preventDefault();
      $(this).parent().find(".inline_description").toggle();
    });
  });