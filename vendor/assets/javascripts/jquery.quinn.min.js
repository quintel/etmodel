(function(e,g){function k(a){var b=a.originalEvent;if(b.touches&&b.touches.length)return b.touches[0].pageX;else if(b.changedTouches&&b.changedTouches.length)return b.changedTouches[0].pageX;return a.pageX}function c(a,b){var d;g.bindAll(this,"clickBar","startDrag","drag","endDrag","handleKeyboardEvent","enableKeyboardEvents","disableKeyboardEvents");this.wrapper=a;this.options=d=g.extend({},c.defaults,b);this.callbacks={};this.disabled=false;this.previousValue=this.activeHandle=null;var h=d.drawTo,
f=d.min,e=d.max,h=h||{};this.drawTo={left:g.has(h,"left")?h.left:f,right:g.has(h,"right")?h.right:e};this.model=new j(this,this.options.strict);this.renderer=new this.options.renderer(this);this.keyFloodTimer=null;this.wrapperOffset=this.wrapperWidth=0;this.on("setup",d.setup);this.on("begin",d.begin);this.on("drag",d.drag);this.on("change",d.change);this.on("abort",d.abort);g.isFunction(this.renderer.render)&&this.renderer.render();d.disable===true&&this.disable();this.trigger("setup",this.model.value)}
function j(a,b){var d,h,c;this.options=d=a.options;this.step=d.step;this.only=d.only;this.values=[];this.minimum=this.roundToStep(d.min);this.maximum=this.roundToStep(d.max);this.minimum<d.min&&(this.minimum+=this.step);this.maximum>d.max&&(this.maximum-=this.step);d=typeof d.value==="undefined"||d.value===null?this.minimum:g.isArray(d.value)?d.value:[d.value];for(c=0,h=d.length;c<h;c++)this.values[c]=null;this.setValue(d,b)}var l="mousemove",m="mousedown",n="mouseup",o=false;"ontouchstart"in document.documentElement&&
(l="touchmove",m="touchstart",n="touchend",o=true);c.VERSION="1.0.5";c.prototype.on=function(a,b){g.isString(a)&&g.isFunction(b)&&(this.callbacks[a]||(this.callbacks[a]=[]),this.callbacks[a].push(b));return this};c.prototype.trigger=function(a,b){var d=this.callbacks[a]||[],c=0,f;if(b===void 0)b=this.value;for(;f=d[c++];)if(f(b,this)===false)return false;return true};c.prototype.enable=function(){if(this.disabled)this.disabled=false,this.trigger("enabled")};c.prototype.disable=function(){if(!this.disabled)this.disabled=
true,this.trigger("disabled")};c.prototype.setValue=function(a,b,d){this.start()&&(this.setTentativeValue(a,b,d)!==false?this.resolve():this.reject());return this.model.value};c.prototype.setTentativeValue=function(a,b,d){var c=this.model.value,f=null,e=null,i;if(typeof a==="undefined"||a===null)return false;if(this.model.values.length>1&&g.isNumber(a)){if(this.activeHandle===null)return false;i=this.model.sanitizeValue(a);a=g.clone(this.model.values);f=a[this.activeHandle-1];e=a[this.activeHandle+
1];f!==null&&i<=f&&(i=f+this.options.step);e!==null&&i>=e&&(i=e-this.options.step);a[this.activeHandle]=i}a=this.model.setValue(a);if(a===false||!d&&!this.trigger("drag",a))return this.model.setValue(c),a!==false&&this.trigger("drag",c),false;this.trigger("redraw",b);return a};c.prototype.stepUp=function(a,b,d){d=d?this.setTentativeValue:this.setValue;return this.model.values.length>1?this.model.value:g.bind(d,this)(this.model.value+this.model.step*(a||1),b)};c.prototype.stepDown=function(a,b,d){return this.stepUp(-(a||
1),b,d)};c.prototype.start=function(){if(this.disabled===true||!this.trigger("begin"))return false;this.previousValue=this.model.value;this.wrapperWidth=this.wrapper.width();this.wrapperOffset=this.wrapper.offset().left;return true};c.prototype.resolve=function(){this.deactivateActiveHandle();if(g.isEqual(this.previousValue,this.model.value))return this.reject(),false;if(!this.trigger("change",this.model.value))return this.setTentativeValue(this.previousValue),this.reject(),false;this.previousValue=
null};c.prototype.reject=function(){this.previousValue=null;this.deactivateActiveHandle();return this.trigger("abort")};c.prototype.valueFromMouse=function(a){return this.drawTo.left+(this.drawTo.right-this.drawTo.left)*this.positionFromMouse(a)};c.prototype.positionFromMouse=function(a){var b=this.wrapperOffset+this.wrapperWidth;return(a<this.wrapperOffset?0:a>b?this.wrapperWidth:a-this.wrapperOffset)/this.wrapperWidth};c.prototype.startDrag=function(a,b){if(!o&&a.which!==1)return true;if(!b&&!this.start())return false;
this.activateHandleWithEvent(a);e(document).on(n+".quinn",this.endDrag).on(l+".quinn",this.drag).on("mouseenter.quinn",this.endDrag);return false};c.prototype.drag=function(a){this.setTentativeValue(this.valueFromMouse(k(a)),false);return a.preventDefault()};c.prototype.endDrag=function(a){e(document).off(n+".quinn").off(l+".quinn").off("mouseenter.quinn");this.resolve();return a.preventDefault()};c.prototype.clickBar=function(a){if(!o&&a.which!==1)return true;this.start()&&(this.activateHandleWithEvent(a),
this.setTentativeValue(this.valueFromMouse(k(a))),this.startDrag(a,true));return a.preventDefault()};c.prototype.activateHandleWithEvent=function(a){var b;if(this.activeHandle)return false;b=this.valueFromMouse(k(a));a=g.min(this.model.values,function(a){return Math.abs(a-b)});a=g.indexOf(this.model.values,a);if(a!==-1)this.activeHandle=a,this.trigger("handleOn",this.activeHandle)};c.prototype.deactivateActiveHandle=function(){if(this.activeHandle!==null&&this.activeHandle!==-1)this.trigger("handleOff",
this.activeHandle),this.activeHandle=null};c.prototype.enableKeyboardEvents=function(a){e(a.target).on("keydown",this.handleKeyboardEvent);e(a.target).on("keyup",this.handleKeyboardEvent)};c.prototype.disableKeyboardEvents=function(a){e(a.target).off("keydown",this.handleKeyboardEvent);e(a.target).off("keyup",this.handleKeyboardEvent)};c.prototype.handleKeyboardEvent=function(a){if(a.type==="keydown"){if(this.keyFloodTimer)window.clearTimeout(this.keyFloodTimer),this.keyFloodTimer=null;if(this.previousValue==
null&&!this.start())return false}else if(a.type==="keyup"){if(this.previousValue!=null)this.options.keyFloodWait?this.keyFloodTimer=window.setTimeout(g.bind(function(){this.resolve()},this),this.options.keyFloodWait):this.resolve();return true}switch(a.which){case 33:this.stepUp(10,false,true);break;case 34:this.stepDown(10,false,true);break;case 37:case 40:a.metaKey?this.setTentativeValue(this.model.minimum,false):this.stepDown(a.altKey?10:1,false,true);break;case 39:case 38:a.metaKey?this.setTentativeValue(this.model.maximum,
false):this.stepUp(a.altKey?10:1,false,true);break;default:return true}a.preventDefault()};j.prototype.setValue=function(a,b){var d=this.values,c,f,a=g.isArray(a)?g.clone(a):[a];for(f=0,c=a.length;f<c;f++)a[f]=this.sanitizeValue(a[f],b);if(g.isEqual(a,d))return false;this.value=this.values=a;if(this.values.length===1)this.value=a[0];return this.value};j.prototype.roundToStep=function(a){var b=1/this.step,b=Math.round(a*b)/b;g.isArray(this.only)&&(b=g.min(this.only,function(b){return Math.abs(b-a)}));
if(b>this.maximum)return b-this.step;else if(b<this.minimum)return b+this.step;return b};j.prototype.sanitizeValue=function(a,b){b!==false&&(a=this.roundToStep(a));if(a>this.maximum)return this.maximum;else if(a<this.minimum)return this.minimum;return a};c.Renderer=function(a){g.bindAll(this,"render","redraw");var b=this;this.quinn=a;this.model=a.model;this.wrapper=a.wrapper;this.options=a.options;this.handles=[];this.lastDraw=[];a.on("redraw",this.redraw);a.on("handleOn",function(a){b.handles[a].addClass("active")});
a.on("handleOff",function(a){b.handles[a].removeClass("active")});a.on("enabled",function(){b.wrapper.removeClass("disabled");b.options.disabledOpacity!==1&&b.wrapper.css("opacity",1)});a.on("disabled",function(){b.wrapper.addClass("disabled");b.options.disabledOpacity!==1&&b.wrapper.css("opacity",b.options.disabledOpacity)})};c.Renderer.prototype.render=function(){function a(a){a.append(e('<div class="left" />'));a.append(e('<div class="main" />'));a.append(e('<div class="right" />'))}var b,d,c;
this.width=this.wrapper.width();this.adjust=-this.wrapper.height();this.bar=e('<div class="bar" />');this.deltaBar=e('<div class="delta-bar" />');this.model.values.length>1&&this.wrapper.addClass("multiple");a(this.bar);this.model.values.length<=2&&(a(this.deltaBar),this.bar.append(this.deltaBar));this.wrapper.html(this.bar);this.wrapper.addClass("quinn");for(b=0,d=this.model.values.length;b<d;b++)this.handles[b]=e('<span class="handle" tabindex="0"></span>'),this.handles[b].on(m,this.quinn.startDrag),
this.quinn.model.values.length<2&&(this.handles[b].on("focus",this.quinn.enableKeyboardEvents),this.handles[b].on("blur",this.quinn.disableKeyboardEvents)),this.bar.append(this.handles[b]);c=this.handles[0].width()+this.adjust;c=-(c/2)+"px";for(b=0,d=this.handles.length;b<d;b++)this.handles[b].css("marginLeft",c);this.wrapper.on(m,this.quinn.clickBar);this.redraw(false)};c.Renderer.prototype.redraw=function(a){var b=this;a!==false&&(a=true);g.each(this.model.values,function(d,c){var f,e;if(d===b.lastDraw[c])return true;
f=b.handles[c].stop();e=b.position(d,b.adjust)+"px";a&&b.options.effects?f.animate({left:e},{duration:b.options.effectSpeed,step:b.redrawDeltaBarInStep(f)}):(f.css("left",e),b.redrawDeltaBar(d,f))});this.lastDraw=g.clone(this.model.values)};c.Renderer.prototype.redrawDeltaBar=function(a,b){var d=null,c=null;this.deltaBar.stop(true);this.model.values.length>1?b?b===this.handles[0]?d=a:c=a:(d=a[0],c=a[1]):a<0?(d=a,c=0):(c=a,d=0);d!==null&&this.deltaBar.css("left",this.position(d)+"px");c!==null&&(c=
this.width-this.position(c),this.deltaBar.css("right",c+"px"))};c.Renderer.prototype.redrawDeltaBarInStep=function(a){if(!this.deltaBar)return function(){};var b=this.quinn.drawTo.left,c=this.quinn.drawTo.right,e=this;return function(f){f/=e.width;e.redrawDeltaBar(f*(c-b)+b,a);return true}};c.Renderer.prototype.position=function(a,b){var c=(a-this.quinn.drawTo.left)/(this.quinn.drawTo.right-this.quinn.drawTo.left)*(b?this.width+b:this.width);if(c<0)return 0;else if(c>this.width)return this.width;
return Math.round(c)};c.defaults={min:0,max:100,drawTo:null,step:1,value:null,strict:true,only:null,disable:false,disabledOpacity:0.5,width:null,handleWidth:null,drag:null,change:null,setup:null,renderer:c.Renderer,keyFloodWait:false,effectSpeed:"fast",effects:true};e.fn.quinn=function(a){return e.each(this,function(){new c(e(this),a)})};e.Quinn=c})(jQuery,_);
