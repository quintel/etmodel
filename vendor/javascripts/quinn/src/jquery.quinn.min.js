(function(d,e){function c(a,b){var f,d;e.bindAll(this,"clickBar","enableDrag","disableDrag","drag");this.wrapper=a;this.options=e.extend({},c.defaults,b);this.isDisabled=!1;this.previousValues=[];this.callbacks={setup:[],begin:[],change:[],commit:[],abort:[]};this.range=this.options.range.slice();this.selectable=this.options.selectable||this.range;f=this.__roundToStep(this.selectable[0]);d=this.__roundToStep(this.selectable[1]);f<this.selectable[0]&&(f+=this.options.step);d>this.selectable[1]&&(d-=
this.options.step);this.selectable=[f,d];this.wrapper.data("quinn",this);this.render();this.__setValue(this.options.value,!1,!1);this.options.disable===!0&&this.disable();this.bind("setup",this.options.onSetup);this.bind("begin",this.options.onBegin);this.bind("change",this.options.onChange);this.bind("commit",this.options.onCommit);this.bind("abort",this.options.onAbort);this.trigger("setup");return this}var h="mousemove",k="mousedown",i="mouseup",g=!1;try{document.createEvent("TouchEvent"),h="touchmove",
k="touchstart",i="touchend",g=!0}catch(l){}c.VERSION="0.3.6";c.prototype.render=function(){function a(a){a.append(d('<div class="left" />'));a.append(d('<div class="main" />'));a.append(d('<div class="right" />'))}var b=this.wrapper.width(),c,e,j;this.bar=d('<div class="bar" />');this.activeBar=d('<div class="active-bar" />');this.handle=d('<span class="handle" />');a(this.bar);a(this.activeBar);c=d('<div class="movable-range" />');this.bar.append(this.activeBar);this.wrapper.html(this.bar);this.wrapper.addClass("quinn");
this.wrapper.append(c.append(this.handle));this.bar.css({width:b.toString()+"px"});e=this.handle.width();j=Math.round(e*0.25);this.bar.css({marginLeft:j.toString()+"px",width:(b-j*2).toString()+"px"});this.wrapper.find(".movable-range").css({width:(b-e).toString()+"px"});this.bar.bind("mousedown",this.clickBar);this.handle.bind(k,this.enableDrag);d.browser.msie&&d.browser.version<9&&c.bind("mousedown",this.clickBar)};c.prototype.rePosition=function(a){var b=this.options,c=((this.value-this.range[0])/
(this.range[1]-this.range[0])*100).toString()+"%";this.handle.stop(!0);this.activeBar.stop(!0);a&&b.effects?this.handle.animate({left:c},{duration:b.effectSpeed,step:e.bind(function(a){this.__positionActiveBar(a/100*(this.range[1]-this.range[0])+this.range[0])},this)}):(this.handle.css("left",c),this.__positionActiveBar(this.value))};c.prototype.__positionActiveBar=function(a){var b;a<0?(b=this.__positionForValue(a),a=this.__positionForValue(0)):(b=this.__positionForValue(0),a=this.__positionForValue(a));
a=this.bar.width()-a;this.activeBar.css("left",b.toString()+"px");this.activeBar.css("right",a.toString()+"px")};c.prototype.setValue=function(a,b,c){this.__willChange()&&(this.__setValue(a,b,c)?this.__hasChanged():this.__abortChange());return this.value};c.prototype.stepUp=function(a){return this.setValue(this.value+this.options.step*(a||1))};c.prototype.stepDown=function(a){return this.stepUp(-(a||1))};c.prototype.disable=function(){this.isDisabled=!0;this.wrapper.addClass("disabled");this.options.disabledOpacity!==
1&&this.wrapper.css("opacity",this.options.disabledOpacity)};c.prototype.enable=function(){this.isDisabled=!1;this.wrapper.removeClass("disabled");this.options.disabledOpacity!==1&&this.wrapper.css("opacity",1)};c.prototype.bind=function(a,b){e.isString(a)&&e.isFunction(b)&&(a.slice(0,2)==="on"&&(a=a.slice(2,a.length).toLowerCase()),this.callbacks[a].push(b));return this};c.prototype.trigger=function(a,b){var c=this.callbacks[a],d,e=0;if(b===void 0)b=this.value;for(;d=c[e++];)if(d(b,this)===!1)return!1;
return!0};c.prototype.clickBar=function(a){if(!g&&a.which!==1)return!0;this.__willChange()&&(this.__setValue(this.__valueFromMouse(a.pageX),!0),g?this.__hasChanged():this.enableDrag(a,!0));return a.preventDefault()};c.prototype.enableDrag=function(a,b){if(!g&&a.which!==1)return!0;if(!b&&!this.__willChange())return!1;this.handle.addClass("active");d(document).bind(i+".quinn",this.disableDrag).bind(h+".quinn",this.drag).bind("mouseenter.quinn",this.disableDrag);return a.preventDefault()};c.prototype.disableDrag=
function(a){d(document).unbind(i+".quinn").unbind(h+".quinn").unbind("mouseenter.quinn");this.handle.removeClass("active");this.__hasChanged();return a.preventDefault()};c.prototype.drag=function(a){var b=a.pageX;if(a.type==="touchmove")b=a.originalEvent.targetTouches[0].pageX;this.__setValue(this.__valueFromMouse(b));return a.preventDefault()};c.prototype.__valueFromMouse=function(a){return this.range[0]+(this.range[1]-this.range[0])*(this.__positionFromMouse(a)/100)};c.prototype.__positionFromMouse=
function(a){var b=this.bar.width(),c=this.bar.offset().left;return(a<c?0:a>c+b?b:a-c)/b*100};c.prototype.__positionForValue=function(a){var b=this.bar.width();a=(a-this.range[0])/(this.range[1]-this.range[0])*b;return a<0?0:a>b?b:a};c.prototype.__roundToStep=function(a){var b=1/this.options.step;b=Math.round(a*b)/b;e.isArray(this.options.only)&&(b=e.min(this.options.only,function(b){return Math.abs(b-a)}));return b>this.selectable[1]?b-this.options.step:b<this.selectable[0]?b+this.options.step:b};
c.prototype.__willChange=function(){if(this.isDisabled===!0||!this.trigger("begin"))return!1;this.previousValues.unshift(this.value);return!0};c.prototype.__hasChanged=function(){if(!this.trigger("commit"))return this.__setValue(e.head(this.previousValues),!0),this.__abortChange(),!1;e.head(this.previousValues)===this.value&&this.__abortChange()};c.prototype.__abortChange=function(){this.previousValues=e.tail(this.previousValues);return this.trigger("abort")};c.prototype.__setValue=function(a,b){e.isNumber(a)?
(a=this.__roundToStep(a),a<this.selectable[0]?a=this.selectable[0]:a>this.selectable[1]&&(a=this.selectable[1])):a=this.selectable[0];if(a===this.value)return!1;if(!this.trigger("change",a))return!1;this.value=a;this.rePosition(b);return!0};c.defaults={range:[0,100],selectable:null,step:1,value:null,only:null,disable:!1,disabledOpacity:0.5,onChange:null,onCommit:null,onSetup:null,effectSpeed:"fast",effects:!0};d.fn.quinn=function(a){return d.each(this,function(){new c(d(this),a)})};d.Quinn=c})(jQuery,
_);
